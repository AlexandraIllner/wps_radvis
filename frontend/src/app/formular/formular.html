<div class="formular-container">
  <h1>Neue Meldung</h1>

  @if (!selectedCategory && description.trim() === '') {
    <p class="hinweistext">
    Bitte wähle eine Kategorie oder gib eine Beschreibung ein!
  </p>
}

<form class="form-spacing">
  <mat-form-field appearance="outline" class="category-field">
    <mat-label>Mängelkategorie</mat-label>
    <mat-select [(ngModel)]="selectedCategory" name="category">
      @for (cat of categories; track cat) {
        <mat-option [value]="cat.valueOf">{{ cat }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline" class="description-field">
    <mat-label>Beschreibung</mat-label>
      <textarea
        matInput
        [(ngModel)]="description"
        maxlength="1000"
        placeholder="Beschreibe den Mangel kurz"
        name="descriptionForm"
        rows="4"
      ></textarea>

    <mat-hint align="end">{{ description?.length || 0 }}/1000</mat-hint>
  </mat-form-field>

      <!-- *ngIf ersetzt wg. deprecation warning
          <p
            *ngIf="!selectedCategory && description.trim() === ''"
            style="color: #d32f2f; margin-top: 0.5rem; font-size: 0.8rem;"
          >
            Bitte wähle eine Kategorie oder gib eine Beschreibung ein!
          </p>-->

    <!-- Template-Referenzvariable: Ermöglicht Kommunikation mit der PhotoUpload-Komponente -->
    <div class="upload-camera-container">
    <app-photo-upload #photoUpload (photosSelected)="onPhotosSelected($event)"></app-photo-upload>
    <app-camera (photoTaken)="onPhotoFromCamera($event); onPhotoAdded($event)"></app-camera>
    </div>

    <button
      type="button"
      mat-raised-button
      color="primary"
      class="submit-button"
      [disabled]="!selectedCategory && description.trim() === ''"
      (click)="submitReport(photoUpload)"
    >
      Meldung senden
    </button>

    @if (isLoading()) {
      <div style="margin-top: 1rem;  display: flex; justify-content: center;" >
        <mat-spinner diameter="30" color="primary"></mat-spinner>
      </div>
    }
  </form>
</div>


